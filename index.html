<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Гра: Стріляй по М</title>
  <style>
    @font-face {
      font-family: 'Joystix';
      src: url('font.otf') format('opentype');
    }

    body {
      font-family: 'Joystix', sans-serif;
      background: #eef;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    #game {
      position: relative;
      width: 100%;
      height: 100vh;
      background: #cce;
    }
    #aim {
      position: absolute;
      top: 0;
      width: 0;
      height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 20px solid black;
      z-index: 20;
    }
    #building {
      position: absolute;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      width: 150px;
      height: 150px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 1px;
    }
    .block {
      width: 50px;
      height: 50px;
      background-image: url('mac.png');
      background-size: 150px 150px;
    }
    .invisible {
      opacity: 0;
      pointer-events: none;
    }
    .projectile {
      position: absolute;
      width: 10px;
      height: 20px;
      background: red;
      border-radius: 4px;
      z-index: 10;
    }
    #controls {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      background: #ffcc00;
      padding: 10px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
    }
    button {
      font-family: 'Joystix', sans-serif;
      font-size: 18px;
      margin: 5px;
      padding: 10px 15px;
      border: none;
      border-radius: 6px;
      background-color: #da291c;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #b81d14;
    }
    #health {
      position: absolute;
      top: 10px;
      left: 10px;
      font-size: 20px;
      font-weight: bold;
      color: #333;
    }
    #restartButton {
      display: none;
    }
  </style>
</head>
<body>
  <div id="game">
    <div id="health">Здоров’я: 100</div>
    <div id="building"></div>
    <div id="aim"></div>
    <div id="controls">
      <button id="moveLeft" onclick="moveLeft()">&larr;</button>
      <button id="shootButton" onclick="shoot()">Вогонь</button>
      <button id="moveRight" onclick="moveRight()">&rarr;</button>
      <button id="restartButton" onclick="restartGame()">Заново</button>
    </div>
  </div>

  <script>
    const aim = document.getElementById('aim');
    const building = document.getElementById('building');
    const healthDisplay = document.getElementById('health');
    const restartButton = document.getElementById('restartButton');
    const moveLeftButton = document.getElementById('moveLeft');
    const shootButton = document.getElementById('shootButton');
    const moveRightButton = document.getElementById('moveRight');
    let aimX = window.innerWidth / 2 - 10;
    let health = 100;
    const damageMap = Array(9).fill(0);

    function updateAim() {
      aim.style.left = aimX + 'px';
    }

    function moveLeft() {
      aimX = Math.max(0, aimX - 20);
      updateAim();
    }

    function moveRight() {
      aimX = Math.min(window.innerWidth - 20, aimX + 20);
      updateAim();
    }

    function createBuilding() {
      building.innerHTML = '';
      for (let i = 0; i < 9; i++) {
        const div = document.createElement('div');
        div.classList.add('block');
        div.style.backgroundPosition = `-${(i % 3) * 50}px -${Math.floor(i / 3) * 50}px`;
        div.dataset.index = i;
        building.appendChild(div);
      }
    }

    function shoot() {
      const projectile = document.createElement('div');
      projectile.classList.add('projectile');
      projectile.style.left = (aimX + 5) + 'px';
      projectile.style.top = '20px';
      document.body.appendChild(projectile);

      let pos = 20;
      const interval = setInterval(() => {
        pos += 10;
        projectile.style.top = pos + 'px';

        const projectileCenter = aimX + 10;
        const blocks = Array.from(building.children);

        blocks.forEach(block => {
          const rect = block.getBoundingClientRect();
          if (
            !block.classList.contains('invisible') &&
            pos + 20 >= rect.top &&
            pos <= rect.bottom &&
            projectileCenter >= rect.left &&
            projectileCenter <= rect.right
          ) {
            const i = parseInt(block.dataset.index);
            damageMap[i]++;
            if (damageMap[i] >= 2) block.classList.add('invisible');
            health = Math.max(0, health - 5);
            healthDisplay.textContent = 'Здоров’я: ' + health;
            checkGameEnd();
            clearInterval(interval);
            projectile.remove();
          }
        });

        if (pos > window.innerHeight) {
          projectile.remove();
          clearInterval(interval);
        }
      }, 20);
    }

    function checkGameEnd() {
      if (damageMap.every(h => h >= 2)) {
        restartButton.style.display = 'inline-block';
        moveLeftButton.style.display = 'none';
        shootButton.style.display = 'none';
        moveRightButton.style.display = 'none';
        aimX = window.innerWidth / 2 - 10;
        updateAim();
      }
    }

    function restartGame() {
      health = 100;
      for (let i = 0; i < damageMap.length; i++) damageMap[i] = 0;
      healthDisplay.textContent = 'Здоров’я: 100';
      createBuilding();
      restartButton.style.display = 'none';
      moveLeftButton.style.display = 'inline-block';
      shootButton.style.display = 'inline-block';
      moveRightButton.style.display = 'inline-block';
      aimX = window.innerWidth / 2 - 10;
      updateAim();
    }

    updateAim();
    createBuilding();
    window.addEventListener('resize', () => {
      aimX = window.innerWidth / 2 - 10;
      updateAim();
    });
  </script>
</body>
</html>
